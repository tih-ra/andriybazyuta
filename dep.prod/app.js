(function(){var a,b,c,d,e,f,g;e=require("kassit/node_modules/express"),f=require("mongoose"),g=require("vimeo-client"),c=require("alleup"),d=a=process.Andriybazyuta=e.createServer(),d.mode=(typeof getMode=="function"?!getMode():!void 0)?"prod":getMode(),b=require("config")[d.mode],d.port=b.app.port,require.paths.unshift(d.mode==="prod"?"./api":"./server.dev/api"),require.paths.unshift(d.mode==="prod"?"./config":"./server.dev/config"),d.sessions_helper=require("helpers/sessions"),d.mode!=="prod"&&d.use(e.logger({format:"[1m :date [1m:method[0m [33m:url[0m :response-time ms[0m :status"})),d.db=f.createConnection("mongo://"+b.db.user+":"+b.db.passwd+"@"+b.db.host+":"+b.db.port+"/"+b.db.database),d.use(e.bodyParser()),d.use(e.cookieParser()),d.use(e.session({secret:"535875805420801"})),d.use(g.middleware({consumerKey:b.vimeo.consumerKey,consumerSecret:b.vimeo.consumerSecret,baseURL:b.app.url,logging:"debug",afterLogin:"/",afterLogout:"/",permission:"read"})),d.alleup=new c({storage:b.app.storage,config_file:"./alleup_conf.json"}),require("routes.js")(d,g),console.log("  ::loading: Andriybazyuta is up and serving at http://localhost:"+d.port),d.listen(d.port)}).call(this);(function(){module.exports=function(a,b){var c,d,e,f;a.get("/",function(a,b){return b.sendfile("andriybazyuta.html")}),a.get("/andriybazyuta.js",function(a,b){return b.sendfile("andriybazyuta.js")}),a.get("/include.json",function(a,b){return b.sendfile("include.json")}),a.get("/static/*",function(a,b){return b.sendfile("static/"+a.params[0])}),f=require("controllers/projects.js"),a.post("/projects",f.post),a.get("/projects",f.list),a.del("/projects/:id",f.destroy),a.post("/projects/:id",f.update),a.post("/projects/:id/items",f.item_post),a.del("/projects/:id/items/:item_id",f.item_destroy),a.post("/projects/:id/videos",f.video_post),a.post("/projects/:id/embeds",f.embed_post),a.del("/projects/:id/embeds/:embed_id",f.embed_destroy),e=require("controllers/main.js"),a.get("/main",e.one),a.post("/main",e.update),a.post("/main/image",e.image),d=require("controllers/codes.js"),a.post("/codes",d.post),a.get("/codes",d.list),a.del("/codes/:id",d.destroy),a.post("/codes/:id",d.update),c=require("controllers/bios.js"),a.post("/bios",c.post),a.get("/bios",c.list),a.del("/bios/:id",c.destroy),a.post("/bios/:id",c.update),a.post("/bios/:id/items",c.item_post),a.post("/bios/:id/items/:item_id",c.item_update),a.del("/bios/:id/items/:item_id",c.item_destroy),a.get("/images/:version/:file",function(b,c){return c.redirect(a.alleup.url(b.params.file,b.params.version))}),a.get("/logged_in",function(b,c){return a.sessions_helper.logged_in(b,c)?c.send(b.session.vimeo):c.end()}),a.get("/vimeo/video",function(a,c){return b.get({method:"vimeo.videos.getAll"},a,function(a,b,d){return c.send(a?a:JSON.parse(b).videos.video)})}),a.mode==="dev"&&a.get("/client.dev/*",function(a,b){return b.sendfile("client.dev/"+a.params[0])});if(a.mode==="prod")return a.get("/client.prod/*",function(a,b){return b.sendfile("client.prod/"+a.params[0])})}}).call(this);(function(){var a,b,c,d;c=a=process.Andriybazyuta,b=require("models/project.js"),d=require("underscore"),exports.post=function(a,d){return c.sessions_helper.auth_required(a,d,function(c){var e;if(c){e=new b({title:a.body.title,body:a.body.body,description:a.body.description}),e.save();return d.send(e)}})},exports.list=function(a,c){return b.find({}).sort("createdAt",1).execFind(function(a,b){return c.send(b)})},exports.destroy=function(a,d){return c.sessions_helper.auth_required(a,d,function(e){if(e)return b.findOne({_id:a.params.id},function(a,b){b.items.forEach(function(a){return c.alleup.remove(a.file,function(a){if(a)return console.log(a)},"project")});return b.remove(function(a){return d.send("removed")})})})},exports.update=function(a,d){return c.sessions_helper.auth_required(a,d,function(c){if(c)return b.findById(a.params.id,function(b,c){c.title=a.body.title,c.description=a.body.description,c.body=a.body.body,c.save();return d.send(c)})})},exports.item_post=function(a,d){return c.sessions_helper.auth_required(a,d,function(e){if(e)return c.alleup.upload(a,d,function(c,d,e){c&&e.send(c);return b.findById(a.params.id,function(a,b){b.items.push({file:d}),b.save(),e.write(d);return e.end()})},"project")})},exports.item_destroy=function(a,d){return c.sessions_helper.auth_required(a,d,function(e){if(e)return b.findById(a.params.id,function(b,e){var f;f=e.items.id(a.params.item_id),c.alleup.remove(f.file,function(a){if(a)return d.send(a)},"project"),f.remove(),e.save();return d.end("deleted")})})},exports.video_post=function(a,e){return c.sessions_helper.auth_required(a,e,function(c){if(c)return b.findById(a.params.id,function(b,c){var f;f=d.filter(c.videos,function(b){return parseInt(b.vimeo_id)===parseInt(a.body.vimeo_id)}),f.length?c.videos[d.indexOf(c.videos,f[0])].remove():c.videos.push({vimeo_id:a.body.vimeo_id}),c.save();return e.end()})})},exports.embed_post=function(a,d){return c.sessions_helper.auth_required(a,d,function(c){if(c)return b.findById(a.params.id,function(b,c){c.embeds.push({src:a.body.src}),c.save();return d.end()})})},exports.embed_destroy=function(a,d){return c.sessions_helper.auth_required(a,d,function(c){if(c)return b.findById(a.params.id,function(b,c){c.embeds.id(a.params.embed_id).remove(),c.save();return d.end()})})}}).call(this);(function(){var a,b,c,d;c=a=process.Andriybazyuta,b=require("models/main.js"),d=require("underscore"),exports.one=function(a,c){return b.findOne({slug:"main"},function(a,d){d||(d=new b({slug:"main"}),d.save());return c.send(d)})},exports.update=function(a,d){return c.sessions_helper.auth_required(a,d,function(c){if(c)return b.findOne({slug:"main"},function(b,c){c.title=a.body.title,c.description=a.body.description,c.address=a.body.address,c.embed=a.body.embed,c.media_type=a.body.media_type,c.save();return d.send(c)})})},exports.image=function(a,d){return c.sessions_helper.auth_required(a,d,function(e){if(e)return c.alleup.upload(a,d,function(a,d,e){a&&console.log(a);return b.findOne({slug:"main"},function(a,b){b.file&&c.alleup.remove(b.file,function(a){if(a)return console.log(a)},"main"),b.file=d,b.save(),e.write(d);return e.end()})},"main")})}}).call(this);(function(){var a,b,c,d;c=a=process.Andriybazyuta,b=require("models/code.js"),d=require("underscore"),exports.post=function(a,d){return c.sessions_helper.auth_required(a,d,function(c){var e;if(c){e=new b({title:a.body.title,body:a.body.body,description:a.body.description,link:a.body.link,languages:a.body.languages}),e.save();return d.send(e)}})},exports.list=function(a,c){return b.find({}).sort("createdAt",1).execFind(function(a,b){return c.send(b)})},exports.destroy=function(a,d){return c.sessions_helper.auth_required(a,d,function(c){if(c)return b.findOne({_id:a.params.id},function(a,b){return b.remove(function(a){return d.send("removed")})})})},exports.update=function(a,d){return c.sessions_helper.auth_required(a,d,function(c){if(c)return b.findById(a.params.id,function(b,c){c.title=a.body.title,c.description=a.body.description,c.body=a.body.body,c.link=a.body.link,c.languages=a.body.languages,c.save();return d.send(c)})})}}).call(this);(function(){var a,b,c,d;c=a=process.Andriybazyuta,b=require("models/bio.js"),d=require("underscore"),exports.post=function(a,d){return c.sessions_helper.auth_required(a,d,function(c){var e;if(c){e=new b({title:a.body.title,body:a.body.body}),e.save();return d.send(e)}})},exports.list=function(a,c){return b.find({}).sort("createdAt",1).execFind(function(a,b){return c.send(b)})},exports.destroy=function(a,d){return c.sessions_helper.auth_required(a,d,function(c){if(c)return b.findOne({_id:a.params.id},function(a,b){return b.remove(function(a){return d.send("removed")})})})},exports.update=function(a,d){return c.sessions_helper.auth_required(a,d,function(c){if(c)return b.findById(a.params.id,function(b,c){c.title=a.body.title,c.body=a.body.body,c.save();return d.send(c)})})},exports.item_post=function(a,d){return c.sessions_helper.auth_required(a,d,function(c){if(c)return b.findById(a.params.id,function(b,c){var e;e=c.items.push({eventedAt:a.body.eventedAt,description:a.body.description}),c.save();return d.send(c.items[e-1])})})},exports.item_update=function(a,d){return c.sessions_helper.auth_required(a,d,function(c){if(c)return b.findById(a.params.id,function(b,c){var e;e=c.items.id(a.params.item_id),e.eventedAt=a.body.eventedAt,e.description=a.body.description,c.save();return d.send(c.items.id(a.params.item_id))})})},exports.item_destroy=function(a,d){return c.sessions_helper.auth_required(a,d,function(c){if(c)return b.findById(a.params.id,function(b,c){c.items.id(a.params.item_id).remove(),c.save();return d.end("deleted")})})}}).call(this);(function(){var a,b,c,d,e,f,g,h;c=require("models/items.js"),e=require("models/videos.js"),b=require("models/embeds.js"),g=require("mongoose"),f=a=process.Andriybazyuta,d=g.Schema,h=new d({title:String,description:String,body:String,createdAt:{type:Date,"default":Date.now},items:[c],videos:[e],embeds:[b]}),module.exports=f.db.model("Project",h)}).call(this);(function(){var a,b,c;c=require("mongoose"),a=c.Schema,b=new a({file:String}),module.exports=b}).call(this);(function(){var a,b,c;b=require("mongoose"),a=b.Schema,c=new a({vimeo_id:Number}),module.exports=c}).call(this);(function(){var a,b,c;c=require("mongoose"),a=c.Schema,b=new a({src:String,createdAt:{type:Date,"default":Date.now}}),module.exports=b}).call(this);(function(){var a,b,c,d,e;d=require("mongoose"),c=a=process.Andriybazyuta,b=d.Schema,e=new b({slug:String,title:String,description:String,address:String,file:String,embed:String,media_type:{type:String,"default":"image"}}),module.exports=c.db.model("Main",e)}).call(this);(function(){var a,b,c,d,e;d=require("mongoose"),c=a=process.Andriybazyuta,b=d.Schema,e=new b({title:String,description:String,body:String,createdAt:{type:Date,"default":Date.now},link:String,languages:String}),module.exports=c.db.model("Code",e)}).call(this);(function(){var a,b,c,d,e,f;b=require("models/bio_items.js"),e=require("mongoose"),d=a=process.Andriybazyuta,c=e.Schema,f=new c({title:String,body:String,items:[b]}),module.exports=d.db.model("Bio",f)}).call(this);(function(){var a,b,c;c=require("mongoose"),a=c.Schema,b=new a({eventedAt:{type:Date,"default":Date.now},description:String}),module.exports=b}).call(this);(function(){exports.logged_in=function(a,b){return a.session.vimeo?!0:!1},exports.auth_required=function(a,b,c){if(a.session.vimeo)return c(!0);b.send("Authentication required",401);return c(!1)}}).call(this)